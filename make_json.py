import mysql.connector
from mysql.connector import Error
import config
import json

# Uses MySQL Connector so it doesnt have to be in a FLASK HTML request.
try:
    db_connection = mysql.connector.connect(
        host = config.databaseInfo.Hostname(),
        user = config.databaseInfo.Username(),
        password = config.databaseInfo.Password(),
        database = config.databaseInfo.DatabaseName(),
    )

    if db_connection.is_connected():
        db_Info = db_connection.get_server_info()
        print("Connected to MariaDB Server Version ", db_Info)

        db_cursor = db_connection.cursor(dictionary = True)

        ######## Change SQL query to select different data #######
        db_cursor.execute("SELECT * FROM vulnerabilities")
        query = db_cursor.fetchall()

        jsonString = json.dumps(query)
        ######## Change filename to change name of output file #######
        jsonFile = open("data.json", "w")
        jsonFile.write(jsonString)
        jsonFile.close()

except Error as e:
    print("Error while connecting to DB", e)
finally:
    if (db_connection.is_connected()):
        db_cursor.close()
        db_connection.close()
        print("DB connection is closed")